<!-- ‰∏ªÈ°µÈù¢ -->
<view class="container">
  <!-- Ê†áÈ¢ò -->
  <view class="header">
    <text class="title">{{isTibetan ? '‡ΩÅ‡ºã‡Ω†‡Ωë‡Ωº‡Ωì‡ºã‡Ω¶‡æ§‡æ±‡Ω≤‡ºã‡Ωñ‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶‡ºã‡Ω†‡Ωõ‡Ω≤‡Ωì' : 'ËÆ°Êï∞Â∞èÁ®ãÂ∫è'}}</text>
    <text class="subtitle">{{isTibetan ? '‡Ωö‡Ωº‡ΩÇ‡Ω¶‡ºã‡ΩÇ‡Ω¶‡Ωº‡ΩÇ‡ºã‡Ωë‡ΩÇ‡Ω∫‡ºã‡Ω¶‡æí‡æ≤‡Ω¥‡Ωñ‡ºç' : 'ËÆ∞ÂΩïÊØèÊó•Âøµ‰Ωõ‰øÆË°åÔºåÁßØÁ¥ØÁ¶èÂæ∑ËµÑÁ≤Æ'}}</text>
    <view class="translate-btn" bindtap="toggleLanguage">
      {{isTibetan ? '‰∏≠Êñá' : '‡Ωñ‡Ωº‡Ωë‡ºã‡Ω°‡Ω≤‡ΩÇ‡ºç'}}
    </view>
  </view>

  <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
  <view class="main-content">
    <!-- Â∑¶‰æßÔºöÁªèÊñáËÆ°Êï∞Âå∫ -->
    <view class="left-section">
      <view class="card chanting-card">
        <view class="card-header">
          <text class="icon">üìñ</text>
          <text class="card-title">{{isTibetan ? '‡ΩÅ‡ºã‡Ω†‡Ωë‡Ωº‡Ωì‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶‡ºã‡ΩÄ' : 'ÁªèÊñáËÆ°Êï∞'}}</text>
        </view>
        
        <!-- ÁªèÊñáËÆ°Êï∞ÂàóË°® -->
        <view class="chanting-list">
          <block wx:for="{{chantingItems}}" wx:key="id">
            <view class="chanting-item">
              <view class="item-header">
                <text class="item-name">{{item.name}}</text>
                <view class="item-actions">
                  <button class="btn-edit" size="mini" bindtap="onEditItem" data-id="{{item.id}}">{{isTibetan ? '‡Ω¢‡æ©‡Ωº‡Ωò‡ºã‡Ω¶‡æí‡æ≤‡Ω≤‡ΩÇ' : 'ÁºñËæë'}}</button>
                  <button class="btn-delete" size="mini" bindtap="onDeleteItem" data-id="{{item.id}}">{{isTibetan ? '‡Ωñ‡Ω¶‡Ω¥‡Ωñ‡Ω¶' : 'Âà†Èô§'}}</button>
                </view>
              </view>
              
              <view class="count-buttons">
                <block wx:for="{{item.quickCounts}}" wx:key="*this" wx:for-item="count">
                  <button class="count-btn" bindtap="onAddCount" data-id="{{item.id}}" data-count="{{count}}">+{{count}}</button>
                </block>
                <view class="custom-input">
                  <input
                    type="number"
                    placeholder="{{isTibetan ? '‡ΩÇ‡Ωû‡Ωì‡ºã‡ΩÇ‡æ±‡Ω≤‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶‡ºã‡ΩÄ' : 'ËæìÂÖ•ÂÖ∂‰ªñÊï∞Â≠ó'}}"
                    class="custom-input-field"
                    bindinput="onCustomInput"
                    data-id="{{item.id}}"
                    value="{{customInputValue[item.id]}}"
                  />
                  <button class="custom-add-btn" catchtap="onAddCustomCount" data-id="{{item.id}}">+</button>
                </view>
              </view>
            </view>
          </block>
        </view>
        
        <!-- Êñ∞Â¢ûÊåâÈíÆ -->
        <view class="add-button-container">
          <button class="btn-primary" bindtap="onAddItem">{{isTibetan ? '‡ΩÅ‡ºã‡Ω†‡Ωë‡Ωº‡Ωì‡ºã‡ΩÇ‡Ω¶‡Ω¢‡ºã‡Ω¶‡æ£‡Ωº‡Ωì‡ºç' : 'Êñ∞Â¢ûÁªèÊñá'}}</button>
        </view>
      </view>
    </view>
    
    <!-- Âè≥‰æßÔºöÁªüËÆ°‰∏éÊ±áÊÄªÂå∫ -->
    <view class="right-section">
      <!-- ÂΩìÊó•Ê±áÊÄª -->
      <view class="card summary-card">
        <view class="card-header">
          <text class="icon">üìÖ</text>
          <text class="card-title">{{isTibetan ? '‡Ωë‡Ω∫‡ºã‡Ω¢‡Ω≤‡ΩÑ‡ºã‡Ω¶‡æ§‡æ±‡Ω≤‡ºã‡Ωñ‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶' : 'ÂΩìÊó•Ê±áÊÄª'}}</text>
        </view>

        <view class="summary-content">
          <block wx:if="{{todayRecords.length > 0}}">
            <block wx:for="{{todayRecords}}" wx:key="timestamp">
              <view class="summary-item">
                <text class="summary-name">{{item.name}}</text>
                <view class="summary-actions">
                  <text class="summary-count">{{item.count}} {{isTibetan ? '‡Ωê‡Ω∫‡ΩÑ‡Ω¶‡ºç' : 'ÈÅç'}}</text>
                  <button class="btn-edit-small" size="mini" bindtap="onEditRecord" data-record="{{item}}">{{isTibetan ? '‡Ω¢‡æ©‡Ωº‡Ωò‡ºã‡Ω¶‡æí‡æ≤‡Ω≤‡ΩÇ' : 'ÁºñËæë'}}</button>
                  <button class="btn-delete-small" size="mini" bindtap="onDeleteRecord" data-record="{{item}}">{{isTibetan ? '‡Ωñ‡Ω¶‡Ω¥‡Ωñ‡Ω¶' : 'Âà†Èô§'}}</button>
                </view>
              </view>
            </block>
          </block>
          <block wx:else>
            <text class="empty-text">{{isTibetan ? '‡Ωë‡Ω∫‡ºã‡Ω¢‡Ω≤‡ΩÑ‡ºã‡ΩÅ‡ºã‡Ω†‡Ωë‡Ωº‡Ωì‡ºã‡Ω¶‡æ§‡æ±‡Ω≤‡ºã‡Ωñ‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶‡ºã‡ΩÄ‡ºã‡Ωò‡Ω∫‡Ωë‡ºç' : '‰ªäÊó•ÊöÇÊó†ËÆ∞ÂΩï'}}</text>
          </block>

          <view class="summary-actions">
            <button class="btn-secondary" size="mini" bindtap="onCopySummary">{{isTibetan ? '‡Ω†‡Ωë‡æ≤‡ºã‡Ωñ‡Ωü‡Ωº‡ºç' : 'Â§çÂà∂'}}</button>
            <button class="btn-danger" size="mini" bindtap="onClearDaily">{{isTibetan ? '‡Ωñ‡Ω¶‡Ω¥‡Ωñ‡Ω¶' : 'Ê∏ÖÁ©∫'}}</button>
          </view>
        </view>
      </view>
      
      <!-- ÊÄªËÆ°ÁªüËÆ° -->
      <view class="card statistics-card">
        <view class="card-header">
          <text class="icon">üìä</text>
          <text class="card-title">{{isTibetan ? '‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡Ω¢‡æ©‡Ω≤‡Ω¶' : 'ÊÄªËÆ°ÁªüËÆ°'}}</text>
        </view>
        
        <!-- ÁªüËÆ°ÈÄâÈ°πÂç° -->
        <view class="tab-container">
          <view 
            class="tab-item {{currentTab === 'daily' ? 'tab-active' : ''}}"
            bindtap="onSwitchTab" 
            data-tab="daily"
          >
                  >
            {{isTibetan ? '‡Ωâ‡Ω≤‡Ωì' : 'Êó•'}}
          </view>
          <view
            class="tab-item {{currentTab === 'monthly' ? 'tab-active' : ''}}"
            bindtap="onSwitchTab"
            data-tab="monthly"
          >
            {{isTibetan ? '‡Ωü‡æ≥' : 'Êúà'}}
          </view>
          <view
            class="tab-item {{currentTab === 'yearly' ? 'tab-active' : ''}}"
            bindtap="onSwitchTab"
            data-tab="yearly"
          >
            {{isTibetan ? '‡Ω£‡Ωº' : 'Âπ¥'}}
          </view>
        </view>
        
        <!-- ÁªüËÆ°ÂÜÖÂÆπ -->
        <view class="statistics-content">
          <block wx:if="{{currentTab === 'daily'}}">
            <view wx:if="{{dailyStatistics.totalCount > 0}}">
              <view class="stat-header">
                <text class="stat-date">{{dailyStatistics.date}}</text>
                <text class="stat-total">{{dailyStatistics.totalCount}}</text>
                <text class="stat-label">{{isTibetan ? '‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶' : 'ÊÄªËÆ°Êï∞'}}</text>
              </view>
              <view class="stat-list">
                <block wx:for="{{dailyStatistics.records}}" wx:key="id">
                  <view class="stat-item">
                    <text>{{item.name}}</text>
                    <text class="stat-count">{{item.count}} {{isTibetan ? '‡Ωê‡Ω∫‡ΩÑ‡Ω¶‡ºç' : 'ÈÅç'}}</text>
                  </view>
                </block>
              </view>
            </view>
            <view wx:else class="empty-stat">
              <text>{{isTibetan ? '‡Ωë‡Ω∫‡ºã‡Ω¢‡Ω≤‡ΩÑ‡ºã‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡Ω¢‡æ©‡Ω≤‡Ω¶‡ºã‡Ωò‡Ω∫‡Ωë' : '‰ªäÊó•ÊöÇÊó†ÁªüËÆ°Êï∞ÊçÆ'}}</text>
            </view>
          </block>

          <block wx:elif="{{currentTab === 'monthly'}}">
            <view wx:if="{{monthlyStatistics.totalCount > 0}}">
              <view class="stat-header">
                <text class="stat-date">{{monthlyStatistics.date}}</text>
                <text class="stat-total">{{monthlyStatistics.totalCount}}</text>
                <text class="stat-label">{{isTibetan ? '‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶' : 'ÊÄªËÆ°Êï∞'}}</text>
              </view>
              <view class="stat-list">
                <block wx:for="{{monthlyStatistics.records}}" wx:key="id">
                  <view class="stat-item">
                    <text>{{item.name}}</text>
                    <text class="stat-count">{{item.count}} {{isTibetan ? '‡Ωê‡Ω∫‡ΩÑ‡Ω¶‡ºç' : 'ÈÅç'}}</text>
                  </view>
                </block>
              </view>
            </view>
            <view wx:else class="empty-stat">
              <text>{{isTibetan ? '‡Ωü‡æ≥‡ºã‡Ω†‡Ωë‡Ω≤‡Ω¢‡ºã‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡Ω¢‡æ©‡Ω≤‡Ω¶‡ºã‡Ωò‡Ω∫‡Ωë' : 'Êú¨ÊúàÊöÇÊó†ÁªüËÆ°Êï∞ÊçÆ'}}</text>
            </view>
          </block>

          <block wx:elif="{{currentTab === 'yearly'}}">
            <view wx:if="{{yearlyStatistics.totalCount > 0}}">
              <view class="stat-header">
                <text class="stat-date">{{yearlyStatistics.date}}</text>
                <text class="stat-total">{{yearlyStatistics.totalCount}}</text>
                <text class="stat-label">{{isTibetan ? '‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶' : 'ÊÄªËÆ°Êï∞'}}</text>
              </view>
              <view class="stat-list">
                <block wx:for="{{yearlyStatistics.records}}" wx:key="id">
                  <view class="stat-item">
                    <text>{{item.name}}</text>
                    <text class="stat-count">{{item.count}} {{isTibetan ? '‡Ωê‡Ω∫‡ΩÑ‡Ω¶‡ºç' : 'ÈÅç'}}</text>
                  </view>
                </block>
              </view>
            </view>
            <view wx:else class="empty-stat">
              <text>{{isTibetan ? '‡Ω£‡Ωº‡ºã‡Ω†‡Ωë‡Ω≤‡Ω¢‡ºã‡Ω¶‡æ°‡Ωº‡Ωò‡Ω¶‡ºã‡Ω¢‡æ©‡Ω≤‡Ω¶‡ºã‡Ωò‡Ω∫‡Ωë' : 'Êú¨Âπ¥ÊöÇÊó†ÁªüËÆ°Êï∞ÊçÆ'}}</text>
            </view>
          </block>
        </view>
      </view>
    </view>
  </view>

  <!-- Â∫ïÈÉ®‰ø°ÊÅØ -->
  <view class="footer">
    <text>{{isTibetan ? '¬© 2026 ‡Ωì‡ΩÑ‡ºã‡Ωî‡Ω†‡Ω≤‡ºã‡Ωñ‡Ω¶‡æô‡Ω∫‡Ωì‡ºã‡Ωî‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶‡ºã‡Ω†‡Ωõ‡Ω≤‡Ωì | ‡Ωë‡ΩÇ‡Ω∫‡ºã‡Ωñ‡ºã‡Ω†‡Ωë‡Ω≤‡ºã‡Ω°‡Ω≤‡Ω¶‡ºã‡Ω¢‡æ´‡Ωº‡ΩÇ‡Ω¶‡ºã‡Ωñ‡æ±‡ΩÑ‡ºã‡Ωò‡ΩÜ‡Ωº‡ΩÇ' : '¬© 2026 Âøµ‰ΩõËÆ°Êï∞Â∞èÁ®ãÂ∫è | ÊÑø‰ª•Ê≠§ÂäüÂæ∑ÔºåÂ∫Ñ‰∏•‰ΩõÂáÄÂúü'}}</text>
  </view>
</view>

<!-- Êñ∞Â¢û/ÁºñËæëÁªèÊñáÊ®°ÊÄÅÊ°Ü -->
<view class="modal {{showModal ? 'modal-show' : ''}}" bindtap="onCloseModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">{{modalTitle}}</text>
    </view>
    
    <view class="modal-body">
      <view class="form-group">
        <text class="form-label">{{isTibetan ? '‡ΩÅ‡ºã‡Ω†‡Ωë‡Ωº‡Ωì‡ºã‡Ωò‡Ω≤‡ΩÑ' : 'ÁªèÊñáÂêçÁß∞'}}</text>
        <input
          class="form-input"
          placeholder="{{isTibetan ? '‡ΩÅ‡ºã‡Ω†‡Ωë‡Ωº‡Ωì‡ºã‡Ωò‡Ω≤‡ΩÑ‡ºã‡Ω†‡Ωë‡æ≤‡Ω∫‡Ωì‡ºã‡Ω¢‡Ωº‡ΩÇ‡Ω¶' : 'ËØ∑ËæìÂÖ•ÁªèÊñáÂêçÁß∞'}}"
          value="{{chantingName}}"
          bindinput="onChantingNameInput"
        />
      </view>

      <view class="form-group">
        <text class="form-label">{{isTibetan ? '‡Ωò‡ΩÇ‡æ±‡Ωº‡ΩÇ‡Ω¶‡ºã‡ΩÇ‡æ≤‡ΩÑ‡Ω¶‡ºã‡Ω†‡Ωá‡Ω£' : 'Âø´Êç∑ËÆ°Êï∞ÈÄâÈ°π'}}</text>
        <view class="quick-counts">
          <input
            class="quick-count-input"
            type="number"
            value="{{quickCount1}}"
            bindinput="onQuickCount1Input"
          />
          <input
            class="quick-count-input"
            type="number"
            value="{{quickCount2}}"
            bindinput="onQuickCount2Input"
          />
          <input
            class="quick-count-input"
            type="number"
            value="{{quickCount3}}"
            bindinput="onQuickCount3Input"
          />
        </view>
      </view>
    </view>

    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCloseModal">{{isTibetan ? '‡Ω†‡ΩÇ‡Ωº‡ΩÇ‡ºã‡Ωî' : 'ÂèñÊ∂à'}}</button>
      <button class="btn-save" bindtap="onSaveItem">{{isTibetan ? '‡Ωâ‡Ω¢‡ºã‡Ωñ' : '‰øùÂ≠ò'}}</button>
    </view>
  </view>
</view>

<!-- ÁºñËæëËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü -->
<view class="modal {{showEditModal ? 'modal-show' : ''}}" bindtap="onCloseEditModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">{{isTibetan ? '‡Ωñ‡ΩÄ‡Ωº‡Ωë‡ºã‡Ωî‡ºã‡Ω¶‡æí‡æ±‡Ω¥‡Ω¢' : 'ÁºñËæëËÆ∞ÂΩï'}}</text>
    </view>

    <view class="modal-body">
      <view class="form-group">
        <text class="form-label">{{isTibetan ? '‡ΩÅ‡ºã‡Ω†‡Ωë‡Ωº‡Ωì‡ºã‡Ωò‡Ω≤‡ΩÑ' : 'ÁªèÊñáÂêçÁß∞'}}</text>
        <input
          class="form-input"
          value="{{editChantingName}}"
          disabled
        />
      </view>

      <view class="form-group">
        <text class="form-label">{{isTibetan ? '‡ΩÇ‡æ≤‡ΩÑ‡Ω¶‡ºã‡Ω†‡Ωõ‡Ω≤‡Ωì' : 'ËÆ°Êï∞'}}</text>
        <input
          class="form-input"
          type="number"
          placeholder="{{isTibetan ? '‡ΩÇ‡æ≤‡ΩÑ‡Ω¶‡ºã‡Ω†‡Ωõ‡Ω≤‡Ωì‡ºã‡Ω†‡Ωë‡æ≤‡Ω∫‡Ωì‡ºã‡Ω¢‡Ωº‡ΩÇ‡Ω¶' : 'ËØ∑ËæìÂÖ•ËÆ°Êï∞'}}"
          value="{{editCount}}"
          bindinput="onEditCountInput"
        />
      </view>
    </view>

    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCloseEditModal">{{isTibetan ? '‡Ω†‡ΩÇ‡Ωº‡ΩÇ‡ºã‡Ωî' : 'ÂèñÊ∂à'}}</button>
      <button class="btn-save" bindtap="onSaveRecord">{{isTibetan ? '‡Ωâ‡Ω¢‡ºã‡Ωñ' : '‰øùÂ≠ò'}}</button>
    </view>
  </view>
</view>

<!-- ÊèêÁ§∫‰ø°ÊÅØ -->
<view class="toast {{showToast ? 'toast-show' : ''}} {{toastType === 'error' ? 'toast-error' : 'toast-success'}}">
  <text class="toast-icon">{{toastType === 'error' ? '‚ùå' : '‚úÖ'}}</text>
  <text class="toast-message">{{toastMessage}}</text>
</view>